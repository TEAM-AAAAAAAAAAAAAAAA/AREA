name: CodeQL Analysis

on:
  push:
    branches:
      - main

jobs:
  codeql-analysis:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code from repo
        uses: actions/checkout@v2

      # used to install codeQl on the testing machine
      - name: Install CodeQL
        run: |
          wget https://github.com/github/codeql/releases/download/v2.1.1/codeql-2.1.1-linux64.tar.gz
          tar -xzvf codeql-2.1.1-linux64.tar.gz
          export PATH=$PWD/codeql-2.1.1-linux64:$PATH

      # these actions are used to create database, run analyze, and store results of analysis
      - name: Create CodeQL database
        run: codeql database create --language=javascript --source-root . --output-path codeql-database

      - name: Run CodeQL Analysis
        run: codeql analysis execute --language javascript --config-file config.yml --output-path codeql-results

      - name: Store CodeQL Results
        uses: actions/upload-artifact@v2
        with:
          name: codeql-results
          path: codeql-results

      # Used to notify that the analysis ended, then please check the report
      - name: Send Notifications
        uses: rtCamp/action-discord-notify@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          message: "CodeQL analysis has completed. Please review the results for any security vulnerabilities."